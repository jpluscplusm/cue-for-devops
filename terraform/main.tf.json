[
    {
        "data": {
            "aws_vpc": {
                "this": {
                    "filter": {
                        "name": "tag:EnvironmentGroup",
                        "values": ["${var.tags.EnvironmentGroup}"]
                    }
                }
            }
        }
    },
    {
        "module": {
            "aws_subnet_public": {
                "source": "../modules/aws/subnet_public",
                "vpc_id": "${data.aws_vpc.this.id}",
                "cidr_block": "${var.cidr_block}",
                "tags": {
                    "tag:Name": "mysubnet"
                },
                "availability_zone": "us-east-1"
            }
        }
    },

    {
        "data": {
            "aws_ami": {
                "this": {
                    "most_recent": true,
                    "filter": {
                        "name": "image-id",
                        "values": ["ami-0b9d9398cc54985a5"]
                    }
                }
            }
        }
    },
    {
        "resource": {
            "aws_network_interface": {
                "this": {
                    "subnet_id": "${module.aws_subnet_public.aws_subnet.id}"
                }
            }
        }
    },
    {
        "resource": {
            "aws_instance": {
                "this": {
                    "ami": "${data.aws_ami.this.id}",
                    "instance_type": "t2.micro",
                    "availability_zone": "${var.availability_zone}",
                    "network_interface": {
                        "network_interface_id": "${aws_network_interface.this.id}",
                        "device_index": 0
                    }
                }
            }
        }
    }
]
